<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>作业批阅系统</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.21.1/dist/axios.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #000000;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 200px;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaeaea;
        }
        h1 {
            color: #ce7827;
            margin-bottom: 5px;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        .upload-section {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #f9f9f9;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px 5px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #2980b9;
        }
        .btn-camera {
            background: #e74c3c;
        }
        .btn-camera:hover {
            background: #c0392b;
        }
        .preview-section {
            border: 1px solid #eaeaea;
            border-radius: 8px;
            overflow: hidden;
        }
        .preview-header {
            background: #f8f9fa;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            border-bottom: 1px solid #eaeaea;
        }
        .preview-content {
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .preview-image {
            max-width: 100%;
            max-height: 300px;
        }
        .preview-placeholder {
            color: #7f8c8d;
            text-align: center;
            padding: 20px;
        }
        .results-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eaeaea;
        }
        .result-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        .result-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .question-id {
            font-weight: bold;
            color: #3498db;
        }
        .result-status {
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 14px;
        }
        .correct {
            background: #d4edda;
            color: #155724;
        }
        .incorrect {
            background: #f8d7da;
            color: #721c24;
        }
        .answer-section {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }
        .answer-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
        .error {
            color: #e74c3c;
            text-align: center;
            padding: 10px;
            margin-top: 10px;
        }
        .camera-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .camera-video {
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
            overflow: hidden;
        }
        .camera-controls {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="app" class="container">
        <header>
            <h1>作业批阅系统</h1>
            <p>上传作业图片，获取智能批阅结果</p>
        </header>

        <div class="main-content">
            <div class="upload-section">
                <p>请选择作业图片或使用摄像头拍照</p>
                <input type="file" accept="image/*" @change="onFileChange" ref="fileInput" style="display: none;">
                <button class="btn" @click="$refs.fileInput.click()">选择图片</button>
                <button class="btn btn-camera" @click="openCamera">拍照上传</button>
            </div>
            
            <div class="preview-section">
                <div class="preview-header">图片预览</div>
                <div class="preview-content">
                    <div v-if="!imageData" class="preview-placeholder">
                        <p>预览区域</p>
                    </div>
                    <img v-else :src="imageData" class="preview-image" alt="预览图片">
                </div>
            </div>
        </div>

        <div class="results-section">
            <h2>批阅结果</h2>
            
            <div v-if="loading" class="loading">
                <p>正在批阅中，请稍候...</p>
            </div>
            
            <div v-if="error" class="error">
                {{ error }}
            </div>
            
            <div v-if="results.length > 0">
                <div v-for="item in results" :key="item.id" class="result-card">
                    <div class="result-header">
                        <span class="question-id">题目 {{ item.id }}</span>
                        <span class="result-status" :class="item.result ? 'correct' : 'incorrect'">
                            {{ item.result ? '正确' : '错误' }}
                        </span>
                    </div>
                    <div class="question-text">{{ item.question }}</div>
                    <div class="answer-section">
                        <div class="answer-title">你的答案</div>
                        <div>{{ item.answer }}</div>
                    </div>
                    <div class="answer-section">
                        <div class="answer-title">参考答案</div>
                        <div>{{ item.correctAnswer }}</div>
                    </div>
                </div>
            </div>
            
            <div v-else-if="!loading" class="preview-placeholder">
                <p>批阅结果将显示在这里</p>
            </div>
        </div>

        <!-- 相机界面 -->
        <div v-if="showCamera" class="camera-container">
            <video ref="video" class="camera-video" autoplay></video>
            <div class="camera-controls">
                <button class="btn" @click="capture">拍照</button>
                <button class="btn btn-camera" @click="closeCamera">关闭</button>
            </div>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                imageData: null,
                results: [],
                loading: false,
                error: null,
                showCamera: false,
                stream: null
            },
            methods: {
                // 处理文件选择
                onFileChange(e) {
                    const file = e.target.files[0];
                    if (file) {
                        this.previewImage(file);
                    }
                },
                
                // 预览图片
                previewImage(file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.imageData = e.target.result;
                        this.uploadImage(file);
                    };
                    reader.readAsDataURL(file);
                },
                
                // 打开摄像头
                openCamera() {
                    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                        navigator.mediaDevices.getUserMedia({ video: true })
                            .then(stream => {
                                this.showCamera = true;
                                this.stream = stream;
                                this.$nextTick(() => {
                                    this.$refs.video.srcObject = stream;
                                });
                            })
                            .catch(error => {
                                this.error = '无法访问摄像头: ' + error.message;
                            });
                    } else {
                        this.error = '您的浏览器不支持摄像头功能';
                    }
                },
                
                // 关闭摄像头
                closeCamera() {
                    if (this.stream) {
                        this.stream.getTracks().forEach(track => track.stop());
                        this.stream = null;
                    }
                    this.showCamera = false;
                },
                
                // 拍照
                capture() {
                    const canvas = document.createElement('canvas');
                    const video = this.$refs.video;
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    canvas.toBlob(blob => {
                        this.previewImage(blob);
                        this.closeCamera();
                    });
                },
                
                // 上传图片到服务器
                uploadImage(file) {
                    this.loading = true;
                    this.error = null;
                    this.results = [];
                    
                    const formData = new FormData();
                    formData.append('image', file);
                    
                    axios.post('http://localhost:3000/api/review', formData, {
                        headers: {
                            'Content-Type': 'multipart/form-data'
                        }
                    })
                    .then(response => {
                        this.results = response.data;
                        this.loading = false;
                    })
                    .catch(error => {
                        this.error = '上传失败: ' + (error.response?.data?.message || error.message);
                        this.loading = false;
                        
                        // 如果是网络错误或服务器不可用，使用模拟数据
                        if (error.code === 'ERR_NETWORK' || error.response?.status >= 500) {
                            this.error += '。使用模拟数据进行演示';
                            // 模拟数据
                            setTimeout(() => {
                                this.results = [
                                    {
                                        "id": "1",
                                        "result": true,
                                        "question": "小雏菊和妈妈同时出发向外婆家走去。调皮的小雏菊每分钟走80米，妈妈每分钟走60米。小雏菊走到外婆家门口突然发现自己忘带花儿了，于是立即沿原路回家去取，行至离外婆家160米处和妈妈相遇。小雏菊离外婆家有多远？",
                                        "answer": "160×2×(80-60)=16(分) 16×60+160=1120(米)",
                                        "correctAnswer": "1120米"
                                    },
                                    {
                                        "id": "2",
                                        "result": true,
                                        "question": "小明和小东两人同时从村里骑车到镇上去，小明每小时行8千米，小东每小时行6千米。小明到镇上后立即原路返回到村里，在距离村里30千米处遇到小东。镇到村里相距多少千米？",
                                        "answer": "30+6=5(时) (5×8+30)÷2=35(km)答：35km",
                                        "correctAnswer": "35千米"
                                    }
                                ];
                                this.loading = false;
                            }, 1000);
                        }
                    });
                }
            },
            beforeDestroy() {
                // 组件销毁前关闭摄像头
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                }
            }
        });
    </script>
</body>
</html>